# 正文

## 什么是技术领导力

* 尊重技术,追求核心基础技术
* 追逐自动化的高效率的工具和技术,同时避免无效率的组织架构和管理
* 解放生产力,追逐人效的提高
* 开发抽象和高质量的可以重用的技术组件
* 坚持高于社会主流的技术标准和要求

## 如何拥有技术领导力

* 能够发现问题,能够发现现有方案的问题
* 能够提供解决问题的思路和方案,并能比较这些方案的优缺点
* 能够做出正确的技术决定,用什么样的技术、什么解决方案、怎样实现来完成一个项目
* 能够用更优雅,更简单,更容易的方式来解决问题
* 能够提高代码或软件的扩展性、重用性和可维护性
* 能够用正确的方式管理团队
* 创新能力

## 程序中的错误处理:错误返回码和异常捕捉

错误可以分为三个大类:

* 资源的错误.当我们的代码去请求一些资源时导致的错误,比如打开一个没有权限的文件,写文件时出现的错误,发送文件到网络端发现网络故障的错误,等等,这一类错误属于程序运行环境的问题.对于这类错误,有的我们可以处理,有的我们则无法处理.比如,内存耗尽、栈溢出或是一些程序运行时关键性资源不能满足等等这些情况,我们只能停止运行,甚至退出整个程序.
* 程序的错误.比如:空指针、非法参数等.这类是我们自己程序的错误,我们要记录下来,写入日志,最好触发监控系统报警
* 用户的错误.比如:`Bad Request`、`Bad Format`等这类由用户不合法输入带来的错误.这类错误基本上是在用户的API层上出现的问题.比如,解析一个XML或JSON文件,或是用户输入的字段不合法之类的

可以看到,这三类错误中,有些事我们希望杜绝发生的,比如程序的Bug,有些则是我们杜绝不了的,比如用户的输入.而对于程序运行环境中的一些错误,则是我们希望可以恢复的.也就是说,我们希望可以通过重试或是妥协的方式来解决这些环境的问题,比如重建网络连接,重新打开一个新的文件.

所以,我们可以这么在逻辑上进行分类:

* 对于我们并不期望会发生的事,我们可以使用异常捕捉;
* 对于我们觉得可能会发生的事,使用返回码.

### 几个错误处理的最佳实践

* 统一分类的错误字典.无论你是使用错误码还是异常捕捉,都需要认真并统一地做好错误的分类.最好是在一个地方定义相关的错误.比如,HTTP的4XX表示客户端有问题,5XX则表示服务端有问题.也就是说,你要建立一个错误字典
* 同类错误的定义最好是可以扩展的
* 定义错误的严重程度,比如,Fatal表示重大错误,Error表示自愿或需求得不到满足,Warning表示并不一定是个错误但还是需要引起注意,Info表示不是错误只是一个信息,Debug表示这是给内部开发人员用于调试程序的.
* 错误日志的输出最好使用错误码,而不是错误信息.
* 忽略错误最好有日志.不然会给维护带来很大的麻烦
* 对于同一个地方不停的报错,最好不要都打到日志里,不然这样会导致其它日志被淹没了,也会导致日志文件太大.最好的实践是,打出一个错误以及出现的次数.
* 不要用错误处理逻辑来处理业务逻辑.也就是说,不要使用异常捕捉这样的方式来处理业务逻辑,而是应该用条件判断.如果一个逻辑控制可以用`if-else`清楚地表达,那就不建议使用异常方式处理.异常捕捉是用来处理不期望发生的事情,而错误码则用来处理可能会发生的事.
* 尽可能在错误发生的地方处理错误.
* 向上尽可能地返回原始的错误.
* 处理错误时,总是要清理已分配的资源.
* 不推荐在循环体里处理错误,这里说的是`try-catch`,绝大多数的情况下你不需要这样做.最好把整个循环体外放在try语句块内,而在外面做catch.
* 不要把大量的代码都放在一个try语句块内.一个try语句块内的语句应该是完成一个简单单一的事情.
* 为你的错误定义提供清楚的文档以及每种错误的代码示例.如果你是做RESTful API方面的,使用Swagger会帮你很容易搞定这个事.
* 对于异步的方式,推荐使用Promise模式处理错误
* 对于分布式的系统,推荐使用APM相关的软件

